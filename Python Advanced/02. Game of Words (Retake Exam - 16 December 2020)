def get_next_position(direction, r, c):
    if direction == 'up':
        return r - 1, c
    elif direction == 'down':
        return r + 1, c
    elif direction == 'left':
        return r, c - 1
    elif direction == 'right':
        return r, c + 1


word = input()
n = int(input())
matrix = []
p_row = 0
p_col = 0

for i in range(n):
    matrix.append([el for el in list(input())])
    for j in range(n):
        if matrix[i][j] == 'P':
            p_row, p_col = i, j


for _ in range(int(input())):
    direction = input()
    next_row, next_col = get_next_position(direction, p_row, p_col)
    if next_row < 0 or next_col < 0 or next_row >= n or next_col >= n:
        if len(word)>0: word = word[:-1]
    elif matrix[next_row][next_col] != '-':
        word += matrix[next_row][next_col]
        matrix[p_row][p_col] = '-'
        p_row, p_col = next_row, next_col
        matrix[p_row][p_col] = 'P'
    else:
        matrix[p_row][p_col] = '-'
        p_row, p_col = next_row, next_col
        matrix[p_row][p_col] = 'P'

print(word)
for i in matrix:
    print(''.join(i))
